The fruit fly Drosophila melanogaster has emerged as a key model organism in
neuroscience, in large part due to the concentration of collaboratively generated
molecular, genetic and digital resources available for it. Here we complement the
approximately 140,000 neuron FlyWire whole-brain connectome1 with a systematic
and hierarchical annotation of neuronal classes, cell types and developmental units
(hemilineages). Of 8,453 annotated cell types, 3,643 were previously proposed in the
partial hemibrain connectome2, and 4,581 are new types, mostly from brain regions
outside the hemibrain subvolume. Although nearly all hemibrain neurons could be
matched morphologically in FlyWire, about one-third of cell types proposed for the
hemibrain could not be reliably reidentified. We therefore propose a new definition
of cell type as groups of cells that are each quantitatively more similar to cells in a
different brain than to any other cell in the same brain, and we validate this definition
through joint analysis of FlyWire and hemibrain connectomes. Further analysis
defined simple heuristics for the reliability of connections between brains, revealed
broad stereotypy and occasional variability in neuron count and connectivity, and
provided evidence for functional homeostasis in the mushroom body through
adjustments of the absolute amount of excitatory input while maintaining the
excitation/inhibition ratio. Our work defines a consensus cell type atlas for the fly
brain and provides both an intellectual framework and open-source toolchain for
brain-scale comparative connectomics.
The adult fruit fly represents the current frontier for whole-brain connectomics.
With 139,255 neurons, the newly completed full adult female
brain (FAFB) connectome is intermediate in log scale between the first
connectome of Caenorhabditis elegans (302 neurons3,4) and the mouse
(108 neurons), a desirable but currently intractable target5. The availability
of a complete adult fly brain connectome now allows brain-spanning
circuits to be mapped and linked to circuit dynamics and behaviour as
has long been possible for the nematode and more recently the Drosophila
larva (3,016 neurons)6. However, the adult fly has richer behaviour,
including complex motor control while walking or in flight7, courtship
behaviour8, involved decision making9, flexible associative memory10,11,
spatial learning12 and complex13,14 multisensory15,16 navigation.
The FlyWire brain connectome reported in our companion paper1
is by some margin the largest and most complex yet obtained. The
full connectome, derived from the approximately 100 teravoxel FAFB
whole-brain electron microscopy (EM) volume17, can be represented
as a graph with 139,255 nodes and around 15.1 million weighted edges.
Here we formulate and answer key questions that are essential to interpreting
connectomes at this scale regarding (1) how we know which
edges are important; (2) how we can simplify the connectome graph
to aid automated or human analysis; and (3) the extent to which this
connectome is a snapshot of a single brain or representative of this
species as a whole (or have we collected a ‘snowflake’?). These questions
are inextricably linked with connectome annotation and cell type
identification18,19 within and across datasets.
At the most basic level, navigating this connectome would be
extremely challenging without a comprehensive system of annotations,
which we now provide. Our annotations represent an indexed
and hierarchical human-readable parts list18,20, enabling biologists
to explore their systems and neurons of interest. Connectome annotation
is also crucial to ensuring data quality as it inevitably reveals
segmentation errors that must be corrected. Furthermore, there is a
rich history in Drosophila of probing the circuit basis of a wide range of
innate and learned behaviours as well as their developmental genetic
origins; realizing the full potential of this dataset is only possible by
cross-identifying cell types within the connectome with those characterized
in the published and in-progress literature. This paper reports
this key component of the connectome together with the open source
tools (Table 1) and resources that we have generated. As the annotation
and proofreading of the connectome are inextricably linked, the
companion paper1 and this paper will preferably be co-cited as they
jointly describe the FlyWire resource.
Comparison with cell types proposed using the partial hemibrain
connectome2 confirmed that the majority of fly cell types is
highly stereotyped, and defined simple rules for which connections
within a connectome are reliable and therefore more likely to
be functional. However, this comparison also revealed unexpected
variability in some cell types and demonstrated that many cell types
originally reported in the hemibrain could not be reliably reidentified.
This discovery necessitated the development and application
of a new robust approach for defining cell types jointly across connectomics
datasets. Overall, this effort lays the foundation both for
deep interrogation of current and anticipated fly connectomes from
normal individuals, but also future studies of sexual dimorphism,
experience-dependent plasticity, development and disease at the wholebrain
scale.
Hierarchical annotation of a connectome
Annotations defining different kinds of neurons are key to exploring
and interpreting any connectome; but, with the FlyWire connectome—
which we report jointly with the companion paper1—now exceeding
the 100,000 neuron mark, they are also both of increased significance
and more challenging to generate. We defined a comprehensive, systematic
and hierarchical set of annotations based on the anatomical
organization of the brain (Fig. 1 and Supplementary Videos 1 and 2), as
well as the developmental origin and coarse morphology of neurons
(Fig. 2). Building on these as well as validating cell types identified
from pre-existing datasets, we then defined a set of consensus terminal
cell types intended to capture the finest level of organization that is
reproducible across brains (Fig. 3).
We first collected and curated basic metadata for every neuron in
the dataset including soma position and side, and entry or exit nerve
for afferent and efferent neurons, respectively (Fig. 1). Our group
also predicted neurotransmitter identity for all neurons as reported
elsewhere21. We then defined a hierarchy of four levels: flow > superclass
> class > cell type, which provide salient labels at different granularities
(Fig. 1a, Supplementary Table 1 and Extended Data Fig. 2).
The first two levels, flow and superclass, were densely annotated:
every neuron is either afferent, efferent or intrinsic to the brain (flow)
and falls into one of the nine superclasses: sensory (periphery to brain),
motor (brain to periphery), endocrine (brain to corpora allata/cardiaca),
ascending (ventral nerve cord (VNC) to brain), descending (brain
to VNC), visual projection (optic lobes to central brain), visual centrifugal
(central brain to optic lobes), or intrinsic to the optic lobes or
the central brain (Fig. 1b and Supplementary Table 2). Mapping to the
https://virtualflybrain.org/ (ref. 22) database enables cross-referencing
of neurons and types with other publications (Methods). Note that
due to an inversion of the left–right axis during the original acquisition
of the FAFB dataset17, identified during preparation of this work
(Extended Data Fig. 1; see the ‘FAFB laterality’ section of the Methods),
frontal figures in this work and the FlyWire connectome1 have the fly’s
left on the viewer’s left, and the fly’s right on the viewer’s right, that
is, the opposite of the usual convention. However, all side labels are
biologically correct.
The class field contains pre-existing neurobiological groupings from
the literature (for example, for central complex neurons; Supplementary
Table 3) and is sparsely annotated (43%) for the central brain, in
large part because past research has favoured some brain areas over
others. In the optic lobes, 99% of neurons have a generic class based
on their neuropil innervation. Finally, 98% of all central brain neurons
were given a terminal cell type, a majority of which could be linked to at
least one report in the literature (Fig. 1c). Our annotations for the optic
lobes include cell types for 92% of neurons in both left and right optic
lobes. A separate report23 will describe comprehensive typing of all
neurons intrinsic to the optic lobes. In total, we collected over 870,000
annotations for all 139,255 neurons; all are available for download and
through neuroglancer scenes (Methods and Extended Data Fig. 11).
A total of 32,388 (23%) neurons are intrinsic to the central brain and
77,536 (54%) neurons are intrinsic to the optic lobes. The optic lobes
and the central brain are connected through 8,053 visual projection
and 524 visual centrifugal neurons. The central brain receives afferent
input through 5,512 sensory and 2,362 ascending neurons. Efferent
output is realized through 1,303 descending, 80 endocrine and 106
motor neurons.
We find marked stereotypy in the number of central brain intrinsic
neurons—for example, between the left and the right hemisphere, they
differ by only 27 (0.1%) neurons. For superclasses with less consistency
in left versus right counts, such as the ascending neurons (140, 11%), the
discrepancies are typically due to ambiguity in the sidedness (Fig. 1d
and Methods).
Combining the dense superclass annotation for all neurons with
the connectome1 gives a birds-eye view of the input/output connectivity
of the central brain (Fig. 1f): 55% of the central brain’s synaptic
input comes from the optic system; 25% from the VNC through
ascending neurons; and only 18% from peripheral sensory neurons.
This is surprising as sensory neurons are almost as numerous as visual
projection neurons (Fig. 1d,e); individual visual projection neurons
therefore provide about 2.5 times more synapses, underscoring the
value of this information stream. Input neurons make about two synapses
onto central brain neurons for every one synapse onto output
neurons. Most output synapses target the VNC through descending
neurons (75%); the rest provide centrifugal feedback onto the optic
system (15%), motor neuron output (9%) and endocrine output to the
periphery (1%).
A full atlas of neuronal lineages
Our top-level annotations (flow, superclass, class) provide a systematic
but relatively coarse grouping of neurons compared with >5,000
terminal cell types expected from previous work on the hemibrain2.
We therefore developed an intermediate level of annotation based on
hemilineages—this provides a powerful bridge between the developmental
origin and molecular specification of neurons and their place
within circuits in the connectome (Fig. 2a).
Central brain neurons and a minority of visual projection neurons
are generated by around 120 identified neuroblasts per hemisphere.
Each of these stem cells is defined by a unique transcriptional code
and generates a stereotyped lineage in a precise birth order by asymmetric
division24–27 (Fig. 2b). Each neuroblast typically produces two
hemilineages28,29 that differ markedly in neuronal morphology and
can express different neurotransmitters from one another, but neurons
in each hemilineage usually express a single fast-acting transmitter21,30.
Hemilineages therefore represent a natural functional as well
as developmental grouping by which to study the nervous system.
Within a hemilineage, neurons form processes that extend together
in one cohesive bundle (the hemilineage tract) that enters, traverses
and interconnects neuropil compartments in a stereotypical pattern
(Fig. 2c). Comparing these features between EM and previous light-level
data31–34 enabled us to compile the first definitive atlas of all hemilineages
in the central brain (Fig. 2c–e and Methods).
In total, we successfully identified 120 neuroblast lineages in FlyWire
comprising 183 hemilineages for 88% (30,233 total) of central brain
neurons (Fig. 2e,f and Extended Data Fig. 3). The unassigned neurons
are likely primary neurons born during embryonic development,
which account for 10% of neurons in the adult brain35,36. We tentatively
designated 3,779 (11%) as primary neurons either based on specific
identification in the literature27 or expert assessment of diagnostic
morphological features such as larger cell bodies and broader projections.
A further 797 neurons (2%) did not co-fasciculate with any
hemilineage tracts, even though their morphology suggested that
they are later-born secondary neurons37. This developmental atlas is
comprehensive as, after reviewing discrepancies between previous
studies (Methods), we identified all 119 expected lineages plus one
new lineage.
The number of neurons per hemilineage can vary widely (Fig. 2h)—for
example, counting both hemispheres, FLAa1 contains just 30 neurons
whereas MBp4 (which makes the numerous Kenyon cells that
are required for memory storage) has 1,335. However, in general, the
number of neurons per hemilineage is between 60 and 282 (10th to
90th percentile, respectively). Nevertheless, the numbers of neurons
within each hemilineage were highly reliable, differing only by 3% (±4%)
between the left and right hemispheres (Fig. 2h). This is consistent
with the near-equality of neurons per hemisphere noted in Fig. 1, and
indicates great precision in the developmental programs controlling
neuron number. We also identified neurons belonging to 125 hemilineages
in the hemibrain dataset (Fig. 2j), a connectome comprising
approximately half of a female fly brain2 (Fig. 3a). The number of
neurons per hemilineage strongly correlates across brains (R2 = 0.98),
with FlyWire hemilineages containing on average around 5% more
neurons (Fig. 2k).
Although hemilineages typically contain functionally and morphologically
related neurons, subgroups can be observed37. We further
divided each hemilineage into distinct morphology groups, each innervating
similar brain regions and taking similar internal tracts, using
NBLAST morphological clustering38 (Fig. 2i, Methods, Extended Data
Fig. 3, Supplementary Files 3 and 4 and Supplementary Video 3). This
generated a total of 528 groupings that are consistent across hemispheres
and provide an additional layer of annotations between the
hemilineage and cell type levels.
Validating cell types across brains
We next sought to compare FlyWire against the hemibrain connectome2;
this contains most of one central brain hemisphere and parts
of the optic lobe. The hemibrain was previously densely cell typed by
a combination of two automated procedures followed by extensive
manual review2,39–41: NBLAST morphology clustering initially yielded
5,235 morphology types; multiple rounds of CBLAST connectivity clustering
split some types, generating 640 connectivity types for a final
total of 5,620 types. We have reidentified just 14% of connectivity types
and therefore use the 5,235 morphology types as a baseline for comparison.
Although 389 (7%) of the hemibrain cell types were previously
established in the literature and recorded in the https://virtualflybrain.
org/ database22, principally through analysis of genetic driver lines19,
the great majority (90%) were newly proposed using the hemibrain,
that is, derived from a single hemisphere of a single animal. This was
reasonable given the pioneering nature of the hemibrain reconstruction,
but the availability of the FlyWire connectome now allows for a
more stringent re-examination.
We approach this by considering each cell type in the hemibrain as a
prediction: if we can reidentify a distinct group of cells with the same
properties in both hemispheres of the FlyWire dataset, then we conclude
that a proposed hemibrain cell type has been tested and validated.
To perform this validation, we first used non-rigid three-dimensional
(3D) registration to map meshes and skeletons of all hemibrain neurons
into FlyWire space, enabling direct co-visualization of both datasets
and a range of automated analyses. We then used NBLAST38 to calculate
morphological similarity scores between all hemibrain neurons and the
approximately 84,000 FlyWire neurons with arbours at least partially
contained within the hemibrain volume (Fig. 3a,b and Extended Data
Fig. 4a–c). We manually reviewed the top five NBLAST hits for a random
sample of individual neuron-to-neuron matches and found that
high NBLAST scores typically indicate a good morphological match
(Fig. 3c). Extrapolating from this sample, we expect 99% of hemibrain
neurons to have a morphologically very similar neuron in FlyWire
(Fig. 3d).
We next attempted to map hemibrain cell types onto FlyWire neurons.
Candidate type matches were manually reviewed by co-visualization
and only those with high confidence were accepted (Fig. 3f–h and
Methods). Crucially, this initial morphological matching process generated
a large corpus of shared cell type labels between datasets; with
these in place, we developed an across-dataset connectivity clustering
method that enabled us to investigate and resolve difficult cases
(see the ‘hemibrain cell type matching with connectivity’ section of
the Methods).
The majority of hemibrain cell types (56%; 2,920 out of 5,235 types)
were unambiguously found in the FlyWire dataset (Fig. 3f). A further
664 (13%) hemibrain types were mapped but had to be either merged
(many:1) or further split (1:many) (Fig. 3h). In total, 7% of proposed
hemibrain types were combined to define new ‘composite’ types (for
example, SIP078,SIP080) because the hemibrain split could not be
recapitulated when examining neurons from both FlyWire and the
hemibrain (Fig. 3i and Extended Data Fig. 4e–g). This is not too surprising
as the hemibrain philosophy was explicitly to err on the side
of splitting in cases of uncertainty2. We found that 5% of proposed
hemibrain types needed to be split, for example, because truncation
of neurons in the hemibrain removed a key defining feature (Fig. 3j).
Together these revisions mean that the 3,584 reidentified hemibrain
cell types map onto 3,643 consensus cell types (Fig. 3h). All revisions
were confirmed by across-dataset connectivity clustering.
Notably, 1,651 (32%) hemibrain cell types could not be reidentified in
FlyWire. Ambiguities due to hemibrain truncation can partially explain
this: we were much more successful at matching neurons that were
not truncated in the hemibrain (Fig. 3g). However, this appears not to
be the main explanation. Especially in cases of multiple, very similar,
‘adjacent’ hemibrain types, we often encountered ‘chains’ of ambiguity
that made assigning types difficult (Fig. 3k). Further investigation
(Fig. 6) suggests that the majority of these unmatched hemibrain types
are not exactly replicable across animals. Instead, we show that multiconnectome
analysis can generate validated cell types that are robust
to interindividual variation.
In conclusion, we validated 3,643 high-confidence consensus cell
type labels for 43,737 neurons from three different hemispheres and
two different brains (Fig. 3g). Collectively these cross-matched neurons
cover 46.5% of central brain edges (comprising 49% of synapses) in the
FlyWire graph. This body of high-confidence cross-identified neurons
enables both within-brain (FlyWire left versus right hemisphere) and
across-brain (FlyWire versus hemibrain) comparisons.
Cell types are highly stereotyped
Using the consensus cell type labels, we found that the numbers of cells
per type across the three hemispheres are closely correlated (Fig. 3l).
About one in six cell types shows a difference in numbers between the
left and right hemisphere and one in three across brains (FlyWire versus
hemibrain). The mean difference in the number of cells per type is small
though: 0.3 (±1.8) within brains and 0.8 (±10) across brains. Importantly,
cell types with fewer neurons per type are less variable (Extended
Data Fig. 4i,j). At the extreme, ‘singleton’ cell types account for 59% of
all types in our sample; they often appear to be embryonic-born, or
early secondary neurons, and only very rarely comprise more than
one neuron—only 3% of neurons that are singletons in both FlyWire
hemispheres have more than 1 member in the hemibrain. By contrast,
more numerous cell types are also more likely to vary in number both
within but even more so across brains (Extended Data Fig. 4i,j).
Synapse counts were also largely consistent within cell types, both
within and across brains. To enable a fair comparison, the FlyWire synapse
cloud was restricted to the smaller hemibrain volume. Although
this does not correct for other potential confounds such as differences
in the synaptic completion rates or synapse detection, pre- and
post-synapse counts per cell type were highly correlated, both within
brains (Pearson R = 0.99; P < 0.001) and across brains (Pearson R = 0.92
and 0.76 for pre- and post-synapses, respectively; P < 0.001; Fig. 4a,b
and Extended Data Fig. 4k,l). This is an important quality control and
pre-requisite for subsequent connectivity comparisons.
The fly brain is mostly left–right symmetric, but inspection of the
FlyWire dataset revealed a small number of asymmetries. For example,
LC6 and LC9 visual projection neurons form a large axon bundle that
follows the normal path in the right hemisphere42 but, in the left hemisphere,
it loops over (that is, medial) the mushroom body peduncle;
nevertheless, the axons still find their correct targets as previously
reported43. We annotated other examples of this ranging from small
additional/missing branches to misguided neurite bundles and found
that only 0.4% of central brain neurons exhibit such biological oddities
(Extended Data Fig. 5).
Interpreting connectomes
Brain wiring develops through a complex and probabilistic developmental
process44,45. To interpret the connectome, it is vital to obtain a
basic understanding of how variable that biological process is. This is
complicated by the fact that the connectome we observe is shaped not
just by biological variability but also by technical noise, for example,
from segmentation issues, synapse detection errors and synaptic completion
rates (the fraction of synapses attached to proofread neurons)
(Fig. 4a). Here we use the consensus cell types to assess which connections
are reliably observed across three hemispheres of connectome
data. We use the term ‘edge’ to describe the set of connections between
two cell types, and its ‘weight’ as the number of unitary synapses (no
threshold, that is, ≥1 synapses) forming that connection.
Weights of individual edges are highly correlated within (Pearson
R = 0.97, P < 0.001) and across (Pearson R = 0.8, P < 0.001) brains (Fig. 4c
and Extended Data Fig. 6a). Consistent with this, cell types exhibit
highly similar connectivity within as well as across brains (Fig. 4d and
Extended Data Fig. 6b,c). While the connectivity (cosine) similarity
across brains is lower than within brains (P < 0.001), the effect size is
small (0.045 ± 0.096) and is at least in part due to the aforementioned
truncation in the hemibrain.
We next examined, for a given edge between two cell types in one
hemisphere, the odds of finding the same connection in another hemisphere
or brain. Examination of 572,980 edges present in at least one
of the three brain hemispheres showed that 53% of the edges observed
in the hemibrain were also found in FlyWire. This fraction is slightly
higher when comparing between the two FlyWire hemispheres: left to
right: 61%; right to left: 59% (Fig. 4e). Weaker edges were less likely to
be consistent: an edge consisting of a single synapse in the hemibrain
has a 42% chance to be also present in a single FlyWire hemisphere, and
only a 16% chance to be seen in both hemispheres of FlyWire (Fig. 4f).
By contrast, any edge of more than ten synapses in any hemisphere
can be reproducibly (>90% of the time, rounded) found in the other
two hemispheres. Although only 16% of all edges meet this threshold,
they comprise around 79% of all synapses (Fig. 4g and Extended Data
Fig. 6e). We also analysed normalized edge weights expressed as the
fraction of the input onto each downstream neuron; this accounts
for the small difference in synaptic completion rate between FlyWire
and the hemibrain. With this treatment, the distributions are almost
identical for within and across brain comparisons (Fig. 4g (compare
the left and right panels)); edges constituting ≥0.9% of the target cell
type’s total inputs have a greater than 90% chance of persisting (Fig. 4g
(right)). Around 7% of edges, collectively containing over half (54%) of
all synapses, meet this threshold.
We observed that the fraction of edges persisting across datasets
plateaued as the edge weight increased. Using a level of 99% edge persistence,
we can define a second principled heuristic: edges greater than
2.6% edge weight (or 31 synapses) can be considered to be strong. Note
that these statistics defined across the whole connectome can have
exceptions in individual neurons. For example, descending neuron
DNp42 receives 34 synapses from PLP146 in FlyWire right, but none
on the left or hemibrain; this may well be an example of developmental
noise (that is, bona fide biological variability, rather than technical
noise).
So far, we have examined only the binary question of whether an
edge exists or not. However, the conservation of edge weight is also
highly relevant for interpreting connectomes. We next considered,
given that an edge is present in two or more hemispheres, the odds
that it will have a similar weight. Edge weights within and across brains
are highly correlated (Fig. 4c), a 30-synapse edge in the hemibrain, for
example, will on average consist of 29 synapses in FlyWire, despite
differences in synaptic detection and completion rates for these two
datasets imaged with different EM modalities1. The variance of edge
weights is considerable though: 25% of all 30-synapse hemibrain edges
will consist of fewer than 13 synapses in FlyWire, and 5% will consist of
only 1–2 synapses. Consistency is greater when looking within FlyWire:
a 30-synapse edge on the left will, on average, consist of 31 synapses
on the right. Still, 25% of all 30-synapse edges on the left will consist of
21 synapses or less on the right, and 5% of only 1–8 synapses (Fig. 4h).
To assess how much of this edge weight variability is biological and
how much is technical, we modelled the impact of technical noise on
a fictive ground truth connectome (Fig. 4i and Methods). This model
was randomly subsampled according to postsynaptic completion
rate (in the mushroom body calyx, for example, there is a 6% difference
between the left and right hemisphere of FlyWire; Extended Data
Fig. 6f), and synapses were randomly added and deleted according
to the false-positive and false-negative rates reported for the synapse
detection46. Repeated application of this procedure generated
a distribution of edge weights between each cell type pair expected
due to technical noise alone. On average, 65% of the observed variability
of edge weight between hemispheres fell within the range
expected due to technical noise; this fraction approached 100% for
weaker synapses (Fig. 4j). For example, cell type LHCENT3 targets
LHAV3g2 with 30 synapses on the left but only 23 on the right of Fly-
Wire, which is within the 5–95% quantiles expected due to technical
noise alone. Overall, this analysis shows that observed variability
(Fig. 4h (left)) is greater than can be accounted for by technical noise,
establishing a lower bound for likely biological variability (Fig. 4k),
and suggests another simple heuristic: differences in edge weights of
30% or less may be entirely due to technical noise and should not be
overinterpreted.
Variability in the mushroom body
The comprehensive annotation of cell types in the FlyWire dataset
revealed that the number of Kenyon cells (KCs), the intrinsic neurons
of the mushroom body, is 30% larger per hemisphere than in the
hemibrain (2,597 KCs in FlyWire right; 2,580 in FlyWire left; and 1,917
in hemibrain), well above the average variation in cell counts (5 ± 12%).
While these KC counts are within the previously reported range47, the
difference presents an opportunity to investigate how connectomes
accommodate perturbations in cell count. The mushroom body contains
five principal cell classes: KCs, mushroom body output neurons
(MBONs), modulatory neurons (dopaminergic neurons (DANs) and
octopaminergic neurons (OANs)), the dorsal paired medial (DPM)
and anterior paired lateral neuron (APL) giant interneurons48 (Fig. 5a).
KCs further divide into five main cell types on the basis of which parts
of the mushroom body they innervate: KCab, KCab-p, KCg-m, KCa′b′
and KCg-d (Fig. 5b). Of those, KCab, KCa′b′ and KCg-m are the primary
recipients of largely random39,49 (but see ref. 50) olfactory input through
around 130 antennal lobe projection neurons (ALPNs) comprising 58
canonical types39,40. Global activity in the mushroom body is regulated
through an inhibitory feedback loop mediated by APL, a single large
GABAergic neuron51. Analogous to the mammalian cerebellum, KCs
transform the dense overlapping odour responses of the early olfactory
system into sparse non-overlapping representations that enable the
animal to discriminate between individual odours during associative
learning52,53. The difference in cell counts is not evenly distributed
across all KC types: KCg-m (and to a lesser extent KCg-d and KCa′b′)
are almost twice as numerous in FlyWire versus hemibrain while KCab
and KCab-p are present in similar numbers (Fig. 5c). Protein starvation
during the larval stage can induce specific increases in KCg-m number54,
suggesting that environmental variations in food resources may have
contributed to this difference.
To examine how this affects the mushroom body circuitry, we opted
to compare the fraction of the input or output synaptic budget across
different KCs, as this is well matched to our question and naturally
handles a range of technical noise issues that seemed particularly
prominent in the mushroom body completion rate (Methods and
Extended Data Fig. 7a). We found that, despite the large difference in
KCg-m cell counts between FlyWire and hemibrain, this cell type consistently
makes and receives 32% and 45% of all KC pre-synapses and
post-synapses, respectively (Fig. 5d and Extended Data Fig. 7e). This
suggested that individual FlyWire KCg-m neurons receive fewer inputs
and make fewer outputs than their hemibrain counterparts. The share of
ALPN outputs allocated to KCg-m is around 55% across all hemispheres
(Fig. 5e), and the average ALPN to KCg-m connection is comparable in
strength across hemispheres (Extended Data Fig. 7f); however, each
KCg-m neuron receives input from a much smaller number of ALPN
types in FlyWire than in the hemibrain (5.74, 5.89 and 8.76 for FlyWire
left, right and hemibrain, respectively; Fig. 5f). FlyWire KCg-m neurons
therefore receive inputs with the same strength but from fewer ALPNs.
This pattern holds for other KCg-m synaptic partners as well. Similar
to the excitatory ALPNs, the share of APL outputs allocated to KCg-m
neurons is essentially constant across hemispheres (Fig. 5g). Thus,
each individual KCg-m neuron receives proportionally less inhibition
from the APL, as well as less excitation, maintaining a similar excitation/
inhibition ratio (Fig. 5h). Furthermore, as a population, KCg-m
neurons contribute similar amounts of input to MBONs (Fig. 5i,j and
Extended Data Fig. 7h).
Past theoretical work has shown that the number (K) of discrete
odour channels (that is, ALPN types) providing input to each KC has
an optimal value for maximizing dimensionality of KC activity and,
therefore, discriminability of olfactory input52,53. The smaller value
for K observed for KCg-m neurons in the FlyWire connectome (Fig. 5g)
raises the question of how dimensionality varies with K for each of the
KC types. Using the neural network rate model described previously52,
we calculated dimensionality as a function of K for each of the KC types,
using the observed KC counts, ALPN to KC connectivity and global
inhibition from the APL. This analysis revealed that optimal values for K
are lower for KCg-m neurons in FlyWire than in the hemibrain (Fig. 5k),
consistent with the observed values.
Taken together, these results demonstrate that, for KCg-m neurons,
the brain compensates for a developmental perturbation by changing
a single parameter: the number of odour channels each KC samples
from. By contrast, KCa′b′ cells, which are also more numerous in Fly-
Wire than in the hemibrain, appear to use a hybrid strategy of reduced
K combined with a reduction in ALPN to KCa′b′ connection strength
(Extended Data Fig. 7f). These findings contradict earlier studies in
which a global increase in KC numbers through genetic manipulation
triggered an increase in ALPN axon boutons (indicating an compensatory
increase in excitatory drive to KCs) and a modest increase in KC
claws (suggesting an increase rather than decrease in K)55,56. This may
be due to the differences in the nature and timing of the perturbation
in KC cell number, and the KC types affected.
Toward multiconnectome cell typing
As the first dense, large-scale connectome of a fly brain, the hemibrain
dataset proposed over 5,000 previously unknown cell types in addition
to confirming around 400 previously reported types recorded
in the http://virtualflybrain.org/ database22. As this defines a de
facto standard cell typing for large parts of the fly brain, our initial
work plan was simply to reidentify hemibrain cell types in FlyWire,
providing a critical resource for the fly neuroscience community.
While this was successful for 68% of hemibrain cell types (Fig. 3),
32% could not be validated. Given the great stereotypy generally
exhibited by the fly nervous system, this result is both surprising and
interesting.
We can imagine two basic categories of explanation. First, that
through ever closer inspection, we may successfully reidentify these
missing cell types. Second, that these definitions, mostly based on
a single brain hemisphere, might not be robust to variation across
individuals. Distinguishing between these two explanations is not at
all straightforward. We began by applying across-dataset connectivity
clustering to large groups of unmatched hemibrain and FlyWire
neurons. We observed that most remaining hemibrain types showed
complex clustering patterns, which both separated neurons from the
same proposed cell type and recombined neurons of different proposed
hemibrain types.
While it is always more difficult to prove a negative result, these
observations strongly suggest that the majority of the remaining
1,696 hemibrain types are not robust to interindividual variation. We
therefore developed a definition of cell type that uses interanimal
variability: a cell type is a group of neurons that are each more similar
to a group of neurons in another brain than to any other neuron in
the same brain. This definition can be used with different similarity
metrics but, for connectomics data, a similarity measure incorporating
morphology and/or connectivity is most useful. Our algorithmic
implementation of this definition operates on the co-clustering dendrogram
by finding the smallest possible clusters that satisfy two
criteria (Fig. 6a): (1) each cluster must contain neurons from all three
hemispheres (hemibrain, FlyWire right and FlyWire left); (2) within
each cluster, the number of neurons from each hemisphere must be
approximately equal.
Determining how to cut a dendrogram generated by data clustering
is a widespread challenge in data science for which there is no single
satisfactory solution. A key advantage of the cell type definition that
we propose is that it provides very strong guidance about how to assign
neurons to clusters. This follows naturally from the fact that connectome
data provide us with all neurons in each dataset, rather than a
random subsample. This advantage of completeness is familiar from
analogous problems such as the ability to identify orthologous genes
when whole genomes are available57.
Analysis of the hemibrain cell type AOTU063 provides a relatively
straightforward example of our approach (Fig. 6b and Extended Data
Fig. 10). Morphology-based clustering generates a single group, comprising
all six AOTU063 neurons from each of the three hemispheres.
However, clustering based on connectivity reveals two discrete groups,
with equal numbers of neurons from each hemisphere, suggesting
that this type should be split further. Here, algorithmic analysis across
multiple connectomes reveals consistent connectivity differences
between subsets of AOTU063 neurons.
To test whether this approach is applicable to more challenging sets
of neurons, we set aside the hemibrain types and performed a complete
retyping of neurons in the central complex (Fig. 6c), a centre for navigation
in the insect brain that has been subject to detailed connectome
analysis41. We selected two large groups of neurons innervating the
fan-shaped body (FB) that show a key difference in organization. The
first group, FC1–3 (357 neurons in total), consists of columnar cell types
that tile the FB innervating adjacent non-overlapping columns. The
second group, FB1–9 (897 neurons in total), contains tangential neurons
where neurons of the same cell type are precisely co-located in space41
(Fig. 6d). Standard NBLAST similarity assumes that neurons of the same
cell type overlap closely in space; although this is true for most central
brain types, it does not hold for repeated columnar neurons such as
those in the optic lobe or these FC neurons of the FB. We therefore
used a connectivity-only distance metric co-clustering across the three
hemispheres. This resulted in seven FC clusters satisfying the above
criteria (Fig. 6e,f). Five of these cross-brain types have a one-to-one
correspondence with hemibrain types, while two are merges of multiple
hemibrain types; only a small number of neurons are recombined
across types (Fig. 6g). For the second group, FB1–9, a combined morphology
and connectivity embedding was used. Co-clustering across
the three hemispheres generated 114 cell types compared to 146 cell
types in the hemibrain (Fig. 6h and Extended Data Fig. 8). In total, 44%
of these types correspond one-to-one to a hemibrain cell type; 11% are
splits (1:many), 12% are merges (many:1) and 33% are recombinations
(many:many) of hemibrain cell types. The 67% (44 + 11 + 12) success
rate of this de novo approach in identifying hemibrain cell types is
slightly higher than the 61% achieved in our directed work in Fig. 3;
it is consistent with the notion that further effort could still identify
some unmatched hemibrain types, but that the majority will probably
require retyping.
All of the preceding efforts have focused on cell typing neurons
contained within both FlyWire and the hemibrain. We next examined
the extensive regions of the brain covered only by FlyWire and not
by hemibrain. Based on the lessons learned from the joint analysis of
hemibrain and FlyWire, we ran a co-clustering of neurons from the
two hemispheres of FlyWire to fill in missing cell types (Fig. 6i,j and
Extended Data Fig. 9). This combined both morphology and connectivity
measures, was carried out separately for each hemilineage and
produced 3,200 new central brain cell types for a total of 8,453 including
the optic lobes. We further compared double-hemisphere (FlyWire
left/right) and triple-hemisphere analysis (FlyWire + hemibrain) for 25
cross-identified lineages that are not truncated in the hemibrain. This
comparison found that 70% of these new types survive addition of a
third hemisphere with minor edits (1:many, many:1). That percentage
increases to 84% if we exclude cases in which just one neuron changes
clusters (Extended Data Fig. 9).
In summary, cell typing based on joint analysis of multiple connectomes
proved capable of recapitulating many cell types identified in
the hemibrain dataset, while also defining new candidate cell types
that are consistent both within and across datasets. Further validation
of the new types proposed by this approach will depend on additional
Drosophila connectomes, which are forthcoming. We predict that cell
types defined in this manner will be substantially more robust than cell
types defined from a single connectome alone.
Discussion
Here we generated human-readable annotations for all neurons in the
fly brain at various levels of granularity: superclass, cell class, hemilineage,
morphology group and cell type. These annotations provide
salient groupings that have already been proven to be useful not only
in our own analyses, but also in many of those in our companion paper1
as well as other publications in the FlyWire paper package introduced
there, and to researchers now using the online platforms Codex
(https://codex.flywire.ai) and FAFB-FlyWire CATMAID spaces (https://
fafb-flywire.catmaid.org). Hemilineage annotations also provide a key
starting point to link the molecular basis of the development of the
central brain to the wiring revealed by the connectome; such work
has already begun in the more repetitive circuits of the optic lobe58.
The cell type atlas that we provide of 8,453 cell types, covering 96.4%
of all neurons in the brain, is to our knowledge the largest ever proposed
(the hemibrain had 5,235) and, crucially, by some margin the largest
ever validated collection of cell types19. In C. elegans, the 118 cell types
inferred from the original connectome have been clearly supported by
analysis of subsequent connectomes and molecular data3,59,60. In a few
cases in mammals, it has been possible to produce catalogues of order
100 cell types that have been validated by multimodal data, for example,
in the retina or motor cortex20,61. Although large scale molecular
atlases in the mouse produce highly informative hierarchies of up to
5,000 clusters62–64, they do not yet try to define terminal cell types—the
finest unit that is robust across individuals—with precision. Here we
tested over 5,000 predicted cell types, resulting in 3,884 validated cell
types using three hemispheres of connectome data. Informed by this,
we use the FlyWire dataset to propose an additional 3,685 cell types.
Lessons for cell typing
Our experience of cell typing the FlyWire dataset together with our
earlier participation in the hemibrain cell typing effort leads us to
draw a number of lessons. First, we think that it is helpful to frame cell
types generated in one dataset as predictions or hypotheses that can be
tested either through additional connectome data or data from other
modalities. Related to this, although the two hemispheres of the same
brain can be treated as two largely independent datasets, we do see
evidence that variability can be correlated across hemispheres (Fig. 4).
We therefore recommend the use of three or more hemispheres to
define and validate new cell types both because of increased statistical
confidence and because across-brain comparisons are a strong test of
cell type robustness. Third, there is no free lunch in the classic lumping
versus splitting debate. The hemibrain cell typing effort preferred to
split rather than lump cell types, reasoning that over-splitting could
easily be remedied by merging cell types at a later date2. Although this
approach seemed reasonable at the time, it appears to have led to cell
types being recombined: when using a single dataset, even domain
experts may find it very hard to distinguish conserved differences
between cell types from interindividual noise. Moreover, although
some recent studies have argued that cell types are better defined by
connectivity than morphology, we find that there is a place for both.
For de novo cell typing of future connectomes, we recommend an initial
morphology-only matching to assign obvious matches; these shared
cell type labels can then be used to define connection similarity across
datasets. This then allows extraction of balanced clusters from combined
morphology and connectivity co-clustering that can be used to
assign or refine existing cell types.
Related to this, we find that across-dataset connection similarity
is an extremely powerful way to identify cell types. However,
connectivity-based typing is typically used iteratively and especially
when used within a single dataset this may lead to selection of idiosyncratic
features. Moreover, neurons can connect similarly but come from
a different developmental lineage, or express a different neurotransmitter,
precluding them from sharing a cell type. Combining these two
points, we would summarize that matching by morphology appears to
be both more robust and sometimes less precise, whereas connectivity
matching is a powerful tool that must be wielded with care.
In conclusion, connectome data are particularly suitable for cell typing:
they are inherently multimodal (by providing morphology and connectivity),
while the ability to see all cells within a brain (completeness)
is uniquely powerful. Our multiconnectome typing approach (Fig. 6)
provides a robust and efficient way to use such data; cell types that
have passed the rigorous test of across-connectome consistency are
very unlikely to be revised (permanence). We suspect that connectome
data will become the gold standard for cell typing. Linking molecular
and connectomics cell types will therefore be key. One promising new
approach is exemplified by the prediction of neurotransmitter identity
directly from EM images21 but many others will be necessary.
Finally, we address the three questions introduced in the introduction.
Can we simplify the connectome graph?
Cell typing reduces the complexity of the connectome graph. This has
important implications for analysis, modelling, experimental work and
developmental biology. For example, we can reduce the 131,811 typed
nodes in the raw connectome graph into a cell type graph with 8,453
nodes; the number of edges is similarly reduced. This should significantly
aid human reasoning about the connectome. It will also make
numerous network analyses possible as well as substantially reduce the
degrees of freedom in brain scale modelling65,66. It is important to note
that, while collapsing multiple cells for a given cell type into a single
node is often desirable, other use cases such as modelling studies may
still need to retain each individual cell. However, if key parameters are
determined on a per cell type basis, then the complexity of the resultant
model can be much reduced. A recent study65 optimized and analysed a
highly successful model of large parts of the fly visual system with just
734 free parameters by using connectomic cell types.
For Drosophila experimentalists using the connectome, cell typing
identifies groups of cells that probably form functional units. Most of
these are linked though http://virtualflybrain.org/ to the published
literature and in many cases to molecular reagents. Others will be more
easily identified for targeted labelling and manipulation after typing.
Finally, cell typing effectively compresses the connectome, reducing
the bits required to store and specify the graph. For a fly-sized connectome,
this is no longer that important for computational analysis, but
it may be important for brain development. Some67 have argued that
evolution has selected highly structured brain connectivity enabling
animals to learn very rapidly, but that these wiring diagrams are far too
complex to be specified explicitly in the genome; rather, they must be
compressed through a ‘genomic bottleneck’, which may itself have been
a crucial part of evolving robust and efficient nervous systems. If we
accept this argument, lossy compression based on aggregating nodes
with similar cell type labels, approximately specifying strong edges and
largely ignoring weak edges would reduce the storage requirements
by orders of magnitude and could be a specific implementation of
this bottleneck.
Which edges are important?
The question of which of the 15.1 million edges in the connectome to
pay attention to is critical for its interpretation. Intuitively, we assume
that the more synapses that connect two neurons, the more important
that connection must be. There is some very limited evidence
in support of this assumption correlating anatomical and functional
connectivity68,69 (compare in mammals70). In lieu of physiological data,
we postulate that edges that are critical to brain function should be
consistently found across brains. By comparing connections between
cell types identified in three hemispheres, we find that edges stronger
than ten synapses or ≥0.9% of the target’s inputs have a greater than
90% chance to be preserved (Fig. 4f). This provides a simple heuristic
for determining which edges are likely to be functionally relevant.
It is also highly consistent with findings from the larval connectome,
in which left–right asymmetries in connectivity vanish after removing
edges weaker than <1.25% (ref. 71). However, note that edges falling
below the threshold might still significantly contribute to the brain’s
function.
We further address an issue that has received little attention (but
see ref. 72): the impact of technical factors (such as segmentation,
proofreading, synapse detection) and biological variability on
the final connectome and how to compensate for it. In our hands,
a model of technical noise could explain up to 30% difference in
edge weights. While this model was made specifically for the two
hemispheres of FlyWire, it highlights the general point that a firm
understanding of all sources of variability will be vital for the young
field of comparative connectomics to distinguish real and artificial
differences.
Have we collected a snowflake?
The field of connectomics has long been criticized for unavoidably low
n73,74, raising the question of whether the brain of a single specimen is
representative for all. For insects, there is a large body of evidence for
morphological and functional stereotypy, although this information is
available for only a minority of neurons and much less is known about
stereotyped connectivity19,75,76. For vertebrate brains, the situation is
less clear again; it is generally assumed that subcortical regions will
be more stereotyped, but cortex also has conserved canonical microcircuits77
and recent evidence has shown that some cortical elements
can be genetically and functionally stereotyped78. Given how critical
stereotypy is for connectomics, it is important to check whether that
premise actually still holds true at the synaptic resolution.
For the fly connectome, the answer to our question is actually both
more nuanced and more interesting than we initially imagined. Based
on conservation of edges between FlyWire and hemibrain hemispheres,
over 50% of the connectome graph is a snowflake. Of course, these
non-reproducible edges are mostly weak. Our criterion for strong
(highly reliable) edges applies to between 7–16% of edges but 50–70%
of synapses.
We previously showed that the early olfactory system of the fly is
highly stereotyped in both neuronal number and connectivity40. That
study used the same EM datasets—FAFB and the hemibrain—but was
limited in scope as only manual reconstruction in FAFB was then available.
We now analyse brain-wide data from two brains (FlyWire and the
hemibrain) and three hemispheres to address this question and find
a high degree of stereotypy at every level: neuron counts are highly
consistent between brains, as are connections above a certain weight.
However, when examining so many neurons in a brain, we can see that
cell counts are very different for some neurons; furthermore, neurons
occasionally do something unexpected (take a different route or make
an extra branch on one side of the brain). In fact, we hypothesize that
such stochastic differences are unnoticed variability present in most
brains; this is reminiscent of the observation that most humans carry
multiple significant genetic mutations. We did observe one example
of a substantial biological difference that was consistent across
hemispheres but not brains: the number of the KCg-m neurons in the
mushroom bodies is almost twice as numerous in FlyWire than in the
hemibrain. Notably, we found evidence that the brain compensates for
this perturbation by modifying connectivity (Fig. 5).
In conclusion, we have not collected a snowflake. The core FlyWire
connectome is highly conserved and the accompanying annotations
will be broadly useful across all studies of D. melanogaster. However,
our analyses show the importance of calibrating our understanding of
biological (and technical) variability—as has recently been done across
animals in C. elegans60 and across hemispheres in larval Drosophila71,79.
This will be crucial when using future connectomes to identify true
biological differences, for example, in sexually dimorphic circuits or
changes due to learning.